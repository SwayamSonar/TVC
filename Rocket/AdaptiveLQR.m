function y = AdaptiveLQR(x)
I = reshape(x(1:9), [3 3]);
w = x(10:12);
q = x(13:16);
Mb = x(17:19);
Thrust = x(20);

A = [(I(1,3)*I(2,2)^2*w(2) - I(1,2)*I(2,3)^2*w(3) + I(1,3)*I(3,2)^2*w(2) - I(1,2)*I(3,3)^2*w(3) + I(1,1)*I(1,2)*I(2,3)*w(2) - I(1,1)*I(1,3)*I(2,2)*w(2) - 2*I(1,2)*I(2,1)*I(2,3)*w(1) + 2*I(1,3)*I(2,1)*I(2,2)*w(1) + I(1,1)*I(1,2)*I(3,3)*w(3) - I(1,1)*I(1,3)*I(3,2)*w(3) - I(1,2)*I(2,2)*I(2,3)*w(2) + I(1,3)*I(2,2)*I(2,3)*w(3) - 2*I(1,2)*I(3,1)*I(3,3)*w(1) + 2*I(1,3)*I(3,1)*I(3,2)*w(1) - I(1,2)*I(3,2)*I(3,3)*w(2) + I(2,1)*I(2,2)*I(3,3)*w(3) - I(2,1)*I(2,3)*I(3,2)*w(3) + I(1,3)*I(3,2)*I(3,3)*w(3) - I(2,2)*I(3,1)*I(3,3)*w(2) + I(2,3)*I(3,1)*I(3,2)*w(2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (w(3)*I(1,2)^2*I(3,3) + 2*I(2,3)*w(2)*I(1,2)^2 - 2*w(2)*I(1,2)*I(1,3)*I(2,2) - w(3)*I(1,2)*I(1,3)*I(3,2) + I(2,3)*w(3)*I(1,2)*I(1,3) - I(2,3)*w(1)*I(1,2)*I(2,2) - w(1)*I(1,2)*I(3,2)*I(3,3) + I(1,1)*I(2,3)*w(1)*I(1,2) - w(3)*I(1,3)^2*I(2,2) + w(1)*I(1,3)*I(2,2)^2 - I(1,1)*w(1)*I(1,3)*I(2,2) + w(1)*I(1,3)*I(3,2)^2 + w(3)*I(2,2)^2*I(3,3) - 2*w(2)*I(2,2)*I(3,2)*I(3,3) - I(2,3)*w(3)*I(2,2)*I(3,2) - w(3)*I(2,2)*I(3,3)^2 - I(3,1)*w(1)*I(2,2)*I(3,3) + 2*I(2,3)*w(2)*I(3,2)^2 + I(2,3)*w(3)*I(3,2)*I(3,3) + I(2,3)*I(3,1)*w(1)*I(3,2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(- w(2)*I(1,2)^2*I(3,3) - w(2)*I(1,2)*I(1,3)*I(2,3) - 2*w(3)*I(1,2)*I(1,3)*I(3,3) + I(3,2)*w(2)*I(1,2)*I(1,3) + w(1)*I(1,2)*I(2,3)^2 + w(1)*I(1,2)*I(3,3)^2 - I(1,1)*w(1)*I(1,2)*I(3,3) + w(2)*I(1,3)^2*I(2,2) + 2*I(3,2)*w(3)*I(1,3)^2 - w(1)*I(1,3)*I(2,2)*I(2,3) - I(3,2)*w(1)*I(1,3)*I(3,3) + I(1,1)*I(3,2)*w(1)*I(1,3) - w(2)*I(2,2)^2*I(3,3) - 2*w(3)*I(2,2)*I(2,3)*I(3,3) + I(3,2)*w(2)*I(2,2)*I(2,3) + w(2)*I(2,2)*I(3,3)^2 - I(2,1)*w(1)*I(2,2)*I(3,3) + 2*I(3,2)*w(3)*I(2,3)^2 - I(3,2)*w(2)*I(2,3)*I(3,3) + I(2,1)*I(3,2)*w(1)*I(2,3))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
 -(w(2)*I(1,1)^2*I(2,3) + w(3)*I(1,1)^2*I(3,3) - 2*w(1)*I(1,1)*I(2,1)*I(2,3) - I(1,3)*w(2)*I(1,1)*I(2,1) - w(3)*I(1,1)*I(2,3)^2 - I(2,2)*w(2)*I(1,1)*I(2,3) - 2*w(1)*I(1,1)*I(3,1)*I(3,3) - I(1,3)*w(3)*I(1,1)*I(3,1) - w(3)*I(1,1)*I(3,3)^2 - I(3,2)*w(2)*I(1,1)*I(3,3) + w(3)*I(2,1)^2*I(3,3) + 2*I(1,3)*w(1)*I(2,1)^2 - w(3)*I(2,1)*I(2,3)*I(3,1) + I(1,3)*w(3)*I(2,1)*I(2,3) - w(2)*I(2,1)*I(3,1)*I(3,3) + I(1,3)*I(2,2)*w(2)*I(2,1) + w(2)*I(2,3)*I(3,1)^2 + 2*I(1,3)*w(1)*I(3,1)^2 + I(1,3)*w(3)*I(3,1)*I(3,3) + I(1,3)*I(3,2)*w(2)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(I(1,1)^2*I(2,3)*w(1) - I(1,3)^2*I(2,1)*w(3) + I(2,3)*I(3,1)^2*w(1) - I(2,1)*I(3,3)^2*w(3) - I(1,1)*I(1,3)*I(2,1)*w(1) + 2*I(1,1)*I(1,2)*I(2,3)*w(2) - 2*I(1,2)*I(1,3)*I(2,1)*w(2) + I(1,1)*I(1,3)*I(2,3)*w(3) - I(1,1)*I(2,2)*I(2,3)*w(1) + I(1,3)*I(2,1)*I(2,2)*w(1) + I(1,1)*I(1,2)*I(3,3)*w(3) - I(1,2)*I(1,3)*I(3,1)*w(3) - I(1,1)*I(3,2)*I(3,3)*w(1) + I(1,3)*I(3,1)*I(3,2)*w(1) + I(2,1)*I(2,2)*I(3,3)*w(3) - I(2,2)*I(2,3)*I(3,1)*w(3) - I(2,1)*I(3,1)*I(3,3)*w(1) - 2*I(2,1)*I(3,2)*I(3,3)*w(2) + 2*I(2,3)*I(3,1)*I(3,2)*w(2) + I(2,3)*I(3,1)*I(3,3)*w(3))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (- w(1)*I(1,1)^2*I(3,3) - w(2)*I(1,1)*I(1,3)*I(2,3) - 2*w(3)*I(1,1)*I(1,3)*I(3,3) + I(3,1)*w(1)*I(1,1)*I(1,3) + w(1)*I(1,1)*I(2,3)^2 + w(1)*I(1,1)*I(3,3)^2 - I(1,2)*w(2)*I(1,1)*I(3,3) + w(2)*I(1,3)^2*I(2,1) + 2*I(3,1)*w(3)*I(1,3)^2 - w(1)*I(1,3)*I(2,1)*I(2,3) - I(3,1)*w(1)*I(1,3)*I(3,3) + I(1,2)*I(3,1)*w(2)*I(1,3) - w(1)*I(2,1)^2*I(3,3) - 2*w(3)*I(2,1)*I(2,3)*I(3,3) + I(3,1)*w(1)*I(2,1)*I(2,3) + w(2)*I(2,1)*I(3,3)^2 - I(2,2)*w(2)*I(2,1)*I(3,3) + 2*I(3,1)*w(3)*I(2,3)^2 - I(3,1)*w(2)*I(2,3)*I(3,3) + I(2,2)*I(3,1)*w(2)*I(2,3))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
 (w(2)*I(1,1)^2*I(2,2) + w(3)*I(1,1)^2*I(3,2) - 2*w(1)*I(1,1)*I(2,1)*I(2,2) - I(1,2)*w(2)*I(1,1)*I(2,1) - w(2)*I(1,1)*I(2,2)^2 - I(2,3)*w(3)*I(1,1)*I(2,2) - 2*w(1)*I(1,1)*I(3,1)*I(3,2) - I(1,2)*w(3)*I(1,1)*I(3,1) - w(2)*I(1,1)*I(3,2)^2 - I(3,3)*w(3)*I(1,1)*I(3,2) + w(3)*I(2,1)^2*I(3,2) + 2*I(1,2)*w(1)*I(2,1)^2 - w(3)*I(2,1)*I(2,2)*I(3,1) + I(1,2)*w(2)*I(2,1)*I(2,2) - w(2)*I(2,1)*I(3,1)*I(3,2) + I(1,2)*I(2,3)*w(3)*I(2,1) + w(2)*I(2,2)*I(3,1)^2 + 2*I(1,2)*w(1)*I(3,1)^2 + I(1,2)*w(2)*I(3,1)*I(3,2) + I(1,2)*I(3,3)*w(3)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(- w(1)*I(1,1)^2*I(2,2) - 2*w(2)*I(1,1)*I(1,2)*I(2,2) - w(3)*I(1,1)*I(1,2)*I(3,2) + I(2,1)*w(1)*I(1,1)*I(1,2) + w(1)*I(1,1)*I(2,2)^2 - I(1,3)*w(3)*I(1,1)*I(2,2) + w(1)*I(1,1)*I(3,2)^2 + w(3)*I(1,2)^2*I(3,1) + 2*I(2,1)*w(2)*I(1,2)^2 - I(2,1)*w(1)*I(1,2)*I(2,2) - w(1)*I(1,2)*I(3,1)*I(3,2) + I(1,3)*I(2,1)*w(3)*I(1,2) + w(3)*I(2,2)^2*I(3,1) - w(1)*I(2,2)*I(3,1)^2 - 2*w(2)*I(2,2)*I(3,1)*I(3,2) - I(3,3)*w(3)*I(2,2)*I(3,1) - I(2,1)*w(3)*I(2,2)*I(3,2) + I(2,1)*w(1)*I(3,1)*I(3,2) + 2*I(2,1)*w(2)*I(3,2)^2 + I(2,1)*I(3,3)*w(3)*I(3,2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (I(1,1)^2*I(3,2)*w(1) - I(1,2)^2*I(3,1)*w(2) + I(2,1)^2*I(3,2)*w(1) - I(2,2)^2*I(3,1)*w(2) + I(1,1)*I(1,3)*I(2,2)*w(2) - I(1,2)*I(1,3)*I(2,1)*w(2) - I(1,1)*I(1,2)*I(3,1)*w(1) + I(1,1)*I(1,2)*I(3,2)*w(2) - I(1,1)*I(2,2)*I(2,3)*w(1) + I(1,2)*I(2,1)*I(2,3)*w(1) + 2*I(1,1)*I(1,3)*I(3,2)*w(3) - 2*I(1,2)*I(1,3)*I(3,1)*w(3) - I(2,1)*I(2,2)*I(3,1)*w(1) - I(1,1)*I(3,2)*I(3,3)*w(1) + I(1,2)*I(3,1)*I(3,3)*w(1) + I(2,1)*I(2,2)*I(3,2)*w(2) + 2*I(2,1)*I(2,3)*I(3,2)*w(3) - 2*I(2,2)*I(2,3)*I(3,1)*w(3) - I(2,1)*I(3,2)*I(3,3)*w(2) + I(2,2)*I(3,1)*I(3,3)*w(2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
 q(1)/2, -q(4)/2, q(3)/2, 0, w(3)/2, -w(2)/2, 0, 0, 0, 0, 0, 0, 0;
 q(4)/2, q(1)/2, -q(2)/2, -w(3)/2, 0, w(1)/2, 0, 0, 0, 0, 0, 0, 0;
 -q(3)/2, q(2)/2, q(1)/2, w(2)/2, -w(1)/2, 0, 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, (18014398509481984*Mb(1)*q(2))/3614073432593295 + (18014398509481984*Mb(2)*q(3))/3614073432593295 + 2*Thrust*q(4), (18014398509481984*Mb(2)*q(2))/3614073432593295 - (18014398509481984*Mb(1)*q(3))/3614073432593295 + 2*Thrust*q(1), 2*Thrust*q(2) - (18014398509481984*Mb(1)*q(4))/3614073432593295 - (18014398509481984*Mb(2)*q(1))/3614073432593295, 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, (18014398509481984*Mb(1)*q(3))/3614073432593295 - (18014398509481984*Mb(2)*q(2))/3614073432593295 - 2*Thrust*q(1), (18014398509481984*Mb(1)*q(2))/3614073432593295 + (18014398509481984*Mb(2)*q(3))/3614073432593295 + 2*Thrust*q(4), (18014398509481984*Mb(1)*q(1))/3614073432593295 - (18014398509481984*Mb(2)*q(4))/3614073432593295 + 2*Thrust*q(3), 0, 0, 0, 0, 0, 0, 0;
 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0;
 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];

B = [(I(2,2)*I(3,3) - I(2,3)*I(3,2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(I(1,2)*I(3,3) - I(1,3)*I(3,2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (I(1,2)*I(2,3) - I(1,3)*I(2,2))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1));
 -(I(2,1)*I(3,3) - I(2,3)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (I(1,1)*I(3,3) - I(1,3)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(I(1,1)*I(2,3) - I(1,3)*I(2,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1));
 (I(2,1)*I(3,2) - I(2,2)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), -(I(1,1)*I(3,2) - I(1,2)*I(3,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1)), (I(1,1)*I(2,2) - I(1,2)*I(2,1))/(I(1,1)*I(2,2)*I(3,3) - I(1,1)*I(2,3)*I(3,2) - I(1,2)*I(2,1)*I(3,3) + I(1,2)*I(2,3)*I(3,1) + I(1,3)*I(2,1)*I(3,2) - I(1,3)*I(2,2)*I(3,1));
 0, 0, 0;
 0, 0, 0;
 0, 0, 0;
 0, 0, 0;
 0, 0, 0;
 0, 0, 0;
 (9007199254740992*q(1)^2)/3614073432593295 + (9007199254740992*q(2)^2)/3614073432593295 - (9007199254740992*q(3)^2)/3614073432593295 - (9007199254740992*q(4)^2)/3614073432593295, (18014398509481984*q(2)*q(3))/3614073432593295 - (18014398509481984*q(1)*q(4))/3614073432593295, 0;
 (18014398509481984*q(1)*q(4))/3614073432593295 + (18014398509481984*q(2)*q(3))/3614073432593295, (9007199254740992*q(1)^2)/3614073432593295 + (9007199254740992*q(3)^2)/3614073432593295 - (9007199254740992*q(2)^2)/3614073432593295 - (9007199254740992*q(4)^2)/3614073432593295, 0;
 0, 0, 0;
 0, 0, 0];

lqr(A,B,diag([1,1,1, 2,2,2, 1,1,1, 2,2, 1,1]), diag([1 1 0.6]))
y = lqr(A,B,diag([1,1,1, 2,2,2, 1,1,1, 2,2, 1,1]), diag([1 1 0.6]));